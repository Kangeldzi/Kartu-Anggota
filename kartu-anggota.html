<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Kartu Digital Anggota</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* SALIN SEMUA CSS ANDA DI SINI (TANPA PERUBAHAN) */
body{
  margin:0;
  background:linear-gradient(180deg,#061b12,#020b07);
  font-family:'Poppins',sans-serif;
  display:flex;
  justify-content:center;
  padding:16px;
  color:#fff;
}

.card{
  width:100%;
  max-width:390px;
  background:linear-gradient(160deg,#0f3d28,#062015);
  border-radius:22px;
  padding:18px;
  box-shadow:0 0 35px rgba(0,255,160,.35);
  border:1px solid rgba(0,255,160,.35);
}

/* ... (SALIN SEMUA CSS LAINNYA TANPA PERUBAHAN) ... */

.status-inactive{
  background:#ff3d0033 !important;
  color:#ffa000 !important;
}
</style>
</head>

<body>

<div class="card" id="cardContent">
  <!-- LOADING STATE -->
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p>Memuat data anggota...</p>
  </div>
  
  <!-- CONTENT (hidden by default) -->
  <div id="content" style="display:none;">
    <div class="header">
      <div class="logo-wrap">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhADAiDm28b0fescUKnqADc9uk3Q2oIptWD-hyzBQXb2AMtoPrxb7Q9Ecr9SDV_RhqA9uWO6qTcepfbfuR7KFWuKUmYYPB-6JfiExBCzT-MljhNh1P1TPsabKvh2rAQzEtZUA0lpiIkIuBxHvHVuXl0GdUWEyaABcfpsHnX_kyDLN_pS2gVNzp_kIP6Vss/s1280/1000007204.jpg">
      </div>
      <h1>KOPERASI ASMARA TANI</h1>
      <small>Kartu Anggota Digital (Mobile-Only)</small>
    </div>

    <div class="status">
      <span id="statusText">AKTIF</span>
    </div>

    <div class="identity">
      <h2 id="nama">Kang L</h2>
      <p id="nia">NIA : KOP-001</p>
    </div>

    <div class="stats">
      <div class="stat"><small>Simpanan Pokok</small><b id="pokok">Rp 0</b></div>
      <div class="stat"><small>Simpanan Wajib</small><b id="wajib">Rp 0</b></div>
      <div class="stat"><small>Simpanan Sukarela</small><b id="sukarela">Rp 0</b></div>
    </div>

    <div class="data">
      <div><span>Alamat</span><b id="alamat">Pamijahan, Bogor</b></div>
      <div><span>Jenis Kelamin</span><b id="jk">Laki-laki</b></div>
      <div><span>Agama</span><b id="agama">Islam</b></div>
      <div><span>NIK</span><b id="nik">3201171212810011</b></div>
      <div><span>Email</span><b id="email">anggota@email.com</b></div>
      <div><span>Telepon</span><b id="telepon">085218483129</b></div>
      <div><span>Tanggal Daftar</span><b id="tglDaftar">18-09-2025</b></div>
      <div><span>Total Simpanan</span><b id="totalSimpanan">Rp 0</b></div>
      <div><span>Total Pinjaman</span><b id="totalPinjaman">Rp 0</b></div>
      <div><span>Estimasi SHU</span><b id="shu">Rp 0</b></div>
    </div>

    <div class="actions">
      <button onclick="window.print()">Cetak</button>
      <button onclick="exportPDF()">Export PDF</button>
    </div>

    <div class="footer">
      Data tersinkronisasi dari Dashboard Admin<br>
      © Koperasi Asmara Tani 2026
      <div class="last-update" id="lastUpdate">Terakhir update: -</div>
    </div>
  </div>
</div>

<!-- 1. PASTIKAN FILE data.js ADA DI FOLDER YANG SAMA -->
<script src="data.js"></script>

<!-- 2. SCRIPT UTAMA -->
<script>
// =================== HELPER FUNCTIONS ===================
function formatRupiah(angka) {
  if (!angka && angka !== 0) return 'Rp 0';
  return 'Rp ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}

function formatDate(dateString) {
  if (!dateString) return '-';
  return dateString;
}

function getParameterByName(name) {
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}

function getStatusClass(status) {
  if (!status) return '';
  const statusLower = status.toLowerCase();
  if (statusLower.includes('tidak') || statusLower.includes('non') || statusLower === 'inactive') {
    return 'status-inactive';
  }
  return '';
}

// =================== LOAD DATA FUNCTION ===================
function loadMemberData() {
  try {
    // 1. Ambil ID dari URL atau pakai default
    const memberId = getParameterByName('id') || 'KOP-001';
    
    console.log('Mencari anggota dengan ID:', memberId);
    console.log('Total data tersedia:', MEMBERS_DATA?.length || 0);
    
    // 2. Cari data anggota
    const memberData = MEMBERS_DATA.find(m => m.ID === memberId) || MEMBERS_DATA[0];
    
    if (!memberData) {
      throw new Error('Data anggota tidak ditemukan');
    }
    
    console.log('Data ditemukan:', memberData);
    
    // 3. Update UI
    updateUI(memberData);
    
    // 4. Tampilkan konten
    showContent();
    
  } catch (error) {
    console.error('Error loading data:', error);
    // Fallback ke data pertama jika error
    if (MEMBERS_DATA && MEMBERS_DATA.length > 0) {
      updateUI(MEMBERS_DATA[0]);
      showContent();
    } else {
      document.getElementById('loading').innerHTML = `
        <div style="color:#ff5555;font-size:48px;">⚠️</div>
        <p>Data tidak tersedia</p>
        <p style="font-size:12px;">Pastikan file data.js sudah ada</p>
      `;
    }
  }
}

// =================== UPDATE UI ===================
function updateUI(data) {
  if (!data) return;
  
  // Update basic info
  document.getElementById('nama').textContent = data.Nama || '-';
  document.getElementById('nia').textContent = `NIA : ${data.ID || '-'}`;
  
  // Update status
  const statusElement = document.getElementById('statusText');
  statusElement.textContent = data.Status || 'AKTIF';
  statusElement.className = getStatusClass(data.Status);
  
  // Update simpanan
  document.getElementById('pokok').textContent = formatRupiah(data['Simpanan Pokok'] || 0);
  document.getElementById('wajib').textContent = formatRupiah(data['Simpanan Wajib'] || 0);
  document.getElementById('sukarela').textContent = formatRupiah(data['Simpanan Sukarela'] || 0);
  
  // Update data pribadi
  document.getElementById('alamat').textContent = data.Alamat || '-';
  document.getElementById('jk').textContent = data['Jenis Kelamin'] || '-';
  document.getElementById('agama').textContent = data.Agama || '-';
  document.getElementById('nik').textContent = data.NIK || '-';
  document.getElementById('email').textContent = data.Email || '-';
  document.getElementById('telepon').textContent = data.WhatsApp || '-';
  document.getElementById('tglDaftar').textContent = formatDate(data['Tanggal Bergabung']);
  
  // Calculate totals
  const pokok = parseFloat(data['Simpanan Pokok']) || 0;
  const wajib = parseFloat(data['Simpanan Wajib']) || 0;
  const sukarela = parseFloat(data['Simpanan Sukarela']) || 0;
  const totalSimpanan = pokok + wajib + sukarela;
  
  document.getElementById('totalSimpanan').textContent = formatRupiah(totalSimpanan);
  document.getElementById('totalPinjaman').textContent = formatRupiah(data['Total Pinjaman'] || 0);
  document.getElementById('shu').textContent = formatRupiah(data['SHU Estimasi'] || 0);
  
  // Update foto jika ada
  if (data.Foto) {
    const logoImg = document.querySelector('.logo-wrap img');
    if (logoImg) {
      logoImg.src = data.Foto;
      logoImg.alt = `Foto ${data.Nama}`;
    }
  }
  
  // Update timestamp
  document.getElementById('lastUpdate').textContent = 
    `Terakhir update: ${new Date().toLocaleString('id-ID')}`;
}

function showContent() {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('content').style.display = 'block';
}

// =================== EXPORT FUNCTION ===================
function exportPDF() {
  // Untuk sementara, gunakan print browser
  window.print();
}

// =================== INITIAL LOAD ===================
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM Loaded, starting data load...');
  loadMemberData();
});

// =================== DEBUG FUNCTIONS ===================
// Untuk testing di console browser
window.showAllData = function() {
  console.log('All Members Data:', MEMBERS_DATA);
};

window.switchMember = function(id) {
  window.location.search = `?id=${id}`;
  loadMemberData();
};
</script>

</body>
</html>
