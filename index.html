<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Kartu Digital Anggota Koperasi</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* [SAMA PERSIS DENGAN CSS ANDA] */
body{
  margin:0;
  background:linear-gradient(180deg,#061b12,#020b07);
  font-family:'Poppins',sans-serif;
  display:flex;
  justify-content:center;
  padding:16px;
  color:#fff;
  min-height:100vh;
}

.card{
  width:100%;
  max-width:390px;
  background:linear-gradient(160deg,#0f3d28,#062015);
  border-radius:22px;
  padding:18px;
  box-shadow:0 0 35px rgba(0,255,160,.35);
  border:1px solid rgba(0,255,160,.35);
  align-self:center;
}

.header{
  text-align:center;
  border-bottom:1px dashed rgba(255,255,255,.25);
  padding-bottom:14px;
}

.logo-wrap{
  width:86px;
  height:86px;
  margin:0 auto 10px;
  border-radius:50%;
  background:rgba(255,255,255,.12);
  backdrop-filter:blur(12px);
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:
    0 0 18px rgba(0,255,160,.6),
    inset 0 0 12px rgba(255,255,255,.25);
  transition:.4s ease;
  animation:float 4s ease-in-out infinite;
}
.logo-wrap:hover{
  transform:scale(1.08);
  box-shadow:0 0 28px rgba(0,255,160,.9);
}
.logo-wrap img{
  width:58px;
  height:58px;
  border-radius:50%;
  object-fit:cover;
}

@keyframes float{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-6px)}
}

.header h1{
  font-size:16px;
  margin:0;
  font-weight:700;
  color:#7dffb2;
}
.header small{
  font-size:11px;
  opacity:.85;
}

.status{
  margin:12px auto;
  text-align:center;
}
.status span{
  padding:6px 18px;
  border-radius:20px;
  background:#00ff9d33;
  color:#00ff9d;
  font-size:12px;
  font-weight:600;
}
.status-inactive{
  background:#ff3d0033 !important;
  color:#ffa000 !important;
}

.identity{
  text-align:center;
  margin:14px 0;
}
.identity h2{
  margin:4px 0;
  font-size:17px;
}
.identity p{
  margin:0;
  font-size:12px;
  color:#a9ffd1;
}

.stats{
  display:grid;
  gridTemplateColumns:repeat(3,1fr);
  gap:10px;
  margin:16px 0;
}
.stat{
  background:rgba(0,255,160,.15);
  border-radius:14px;
  padding:10px;
  text-align:center;
}
.stat small{
  font-size:10px;
  opacity:.9;
}
.stat b{
  display:block;
  marginTop:6px;
  font-size:13px;
}

.data{
  font-size:12px;
}
.data div{
  display:flex;
  justify-content:space-between;
  padding:7px 0;
  border-bottom:1px dashed rgba(255,255,255,.25);
}
.data span{
  color:#b6ffd9;
}

.actions{
  display:flex;
  gap:12px;
  margin:18px 0 6px;
}
.actions button{
  flex:1;
  border:none;
  padding:10px;
  border-radius:14px;
  background:rgba(0,255,160,.2);
  color:#00ff9d;
  font-weight:600;
  backdrop-filter:blur(10px);
  box-shadow:0 0 14px rgba(0,255,160,.5);
  transition:.3s;
  cursor:pointer;
  font-family:'Poppins',sans-serif;
}
.actions button:hover{
  background:#00ff9d;
  color:#003a24;
  transform:translateY(-2px);
}

.footer{
  margin-top:10px;
  text-align:center;
  font-size:10px;
  opacity:.75;
}

.loading{
  text-align:center;
  padding:30px;
}
.spinner{
  width:40px;
  height:40px;
  border:3px solid rgba(0,255,160,.3);
  border-top:3px solid #00ff9d;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto 15px;
}
@keyframes spin{
  0%{transform:rotate(0deg)}
  100%{transform:rotate(360deg)}
}

.last-update{
  font-size:9px;
  text-align:center;
  margin-top:5px;
  opacity:.6;
}

.error-message{
  background:rgba(255,0,0,0.1);
  border:1px solid rgba(255,0,0,0.3);
  border-radius:10px;
  padding:10px;
  margin:10px 0;
  text-align:center;
  font-size:11px;
  color:#ff9999;
}

.id-display{
  text-align:center;
  font-size:10px;
  color:#7dffb2;
  margin-top:5px;
  padding:5px;
  background:rgba(0,255,160,0.1);
  border-radius:8px;
}
</style>
</head>

<body>

<div class="card" id="cardContent">
  <!-- LOADING STATE -->
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p>Memuat data dari Google Sheets...</p>
    <div class="id-display" id="loadingId">ID: Loading...</div>
  </div>
  
  <!-- ERROR MESSAGE (hidden by default) -->
  <div class="error-message" id="errorMessage" style="display:none;">
    ‚ö†Ô∏è <span id="errorText"></span>
  </div>
  
  <!-- CONTENT (hidden by default) -->
  <div id="content" style="display:none;">
    <div class="header">
      <div class="logo-wrap">
        <!-- FOTO DEFAULT - AKAN DIUPDATE OTOMATIS -->
        <img id="fotoProfil" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjh1oM43gxD4iCHpHRBrrbkCHRU5MigalAWf4G5x-cTLfRRxWeeTwGqwNz8FtSdSgcexhRAIWMX7eZoOxo0b-i8kB2EUr44TCkMCZ8VVfQTJpL0AgptbY8hjsTZtqg6jbS2MMOuIVf9FvNOR-JsZr4dvrpqTQT0I5qY5OB063z38W0mTIVhQrBPTASmQp0/s1280/1000175639.jpg">
      </div>
      <h1>KOPERASI ASMARA TANI</h1>
      <small>Kartu Anggota Digital</small>
    </div>

    <div class="status">
      <span id="statusText">AKTIF</span>
    </div>

    <div class="identity">
      <h2 id="nama">Loading...</h2>
      <p id="nia">NIA : Loading...</p>
    </div>

    <div class="stats">
      <div class="stat"><small>Simpanan Pokok</small><b id="pokok">Rp 0</b></div>
      <div class="stat"><small>Simpanan Wajib</small><b id="wajib">Rp 0</b></div>
      <div class="stat"><small>Simpanan Sukarela</small><b id="sukarela">Rp 0</b></div>
    </div>

    <div class="data">
      <div><span>Alamat</span><b id="alamat">Loading...</b></div>
      <div><span>Jenis Kelamin</span><b id="jk">Loading...</b></div>
      <div><span>Agama</span><b id="agama">Loading...</b></div>
      <div><span>NIK</span><b id="nik">Loading...</b></div>
      <div><span>Email</span><b id="email">Loading...</b></div>
      <div><span>Telepon</span><b id="telepon">Loading...</b></div>
      <div><span>Tanggal Daftar</span><b id="tglDaftar">Loading...</b></div>
      <div><span>Total Simpanan</span><b id="totalSimpanan">Rp 0</b></div>
      <div><span>Total Pinjaman</span><b id="totalPinjaman">Rp 0</b></div>
      <div><span>Estimasi SHU</span><b id="shu">Rp 0</b></div>
    </div>

    <div class="actions">
      <button onclick="window.print()">üñ®Ô∏è Cetak</button>
      <button onclick="exportPDF()">üì• Export PDF</button>
      <button onclick="refreshData()">üîÑ Refresh</button>
    </div>

    <div class="footer">
      Data real-time dari Google Sheets<br>
      ¬© Koperasi Asmara Tani <span id="currentYear"></span>
      <div class="last-update" id="lastUpdate">Terakhir update: -</div>
    </div>
  </div>
</div>

<script>
// =================== CONFIGURATION ===================
const CONFIG = {
  // OPENSHEET URL - GUNAKAN INI
  OPENSHEET_URL: 'https://opensheet.elk.sh/1lWx-Utyl91udeO00NRfED3DydP39z1NXsX7grnzKEgU/Sheet1',
  
  // Atau gunakan API langsung dari Google Sheets (alternatif)
  GOOGLE_SHEETS_API: 'https://docs.google.com/spreadsheets/d/1lWx-Utyl91udeO00NRfED3DydP39z1NXsX7grnzKEgU/gviz/tq?tqx=out:json',
  
  DEFAULT_ID: 'NIA-001',
  REFRESH_INTERVAL: 30,
  
  DEFAULT_PHOTO: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjh1oM43gxD4iCHpHRBrrbkCHRU5MigalAWf4G5x-cTLfRRxWeeTwGqwNz8FtSdSgcexhRAIWMX7eZoOxo0b-i8kB2EUr44TCkMCZ8VVfQTJpL0AgptbY8hjsTZtqg6jbS2MMOuIVf9FvNOR-JsZr4dvrpqTQT0I5qY5OB063z38W0mTIVhQrBPTASmQp0/s1280/1000175639.jpg',
  
  // Data instan untuk loading cepat
  INSTANT_DATA: {
    'NIA-001': {
      ID: 'NIA-001',
      Nama: 'Eldi Sugianto, S.Kom',
      Email: 'siliwangi4212@gmail.com',
      Status: 'AKTIF',
      Posisi: 'Anggota',
      Alamat: 'Kp. Banjar Karya Rt. 02 Rw. 01 Desa Ciasmara Kecamatan Pamijahan Kabupaten Bogor Kode POS 16810',
      WhatsApp: '85218483129',
      Jenis_Kelamin: 'Laki-laki',
      Agama: 'Islam',
      NIK: '3201171212810011',
      Tanggal_Bergabung: '18 September 2020',
      Simpanan_Pokok: '200000',
      SHU_Estimasi: '44000',
      Foto: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjh1oM43gxD4iCHpHRBrrbkCHRU5MigalAWf4G5x-cTLfRRxWeeTwGqwNz8FtSdSgcexhRAIWMX7eZoOxo0b-i8kB2EUr44TCkMCZ8VVfQTJpL0AgptbY8hjsTZtqg6jbS2MMOuIVf9FvNOR-JsZr4dvrpqTQT0I5qY5OB063z38W0mTIVhQrBPTASmQp0/s1280/1000175639.jpg'
    }
  }
};

// =================== GLOBAL VARIABLES ===================
let currentMemberId = CONFIG.DEFAULT_ID;
let allMembersData = {};

// =================== HELPER FUNCTIONS ===================
function formatRupiah(angka) {
  if (!angka && angka !== 0) return 'Rp 0';
  return 'Rp ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}

function formatDate(dateString) {
  if (!dateString || dateString === '-' || dateString === 'Loading...') return dateString || '-';
  
  try {
    // Coba parse berbagai format tanggal
    let date;
    
    // Format: "18 September 2020"
    if (dateString.includes('September') || dateString.includes('Januari') || dateString.includes('Februari')) {
      const months = {
        'Januari': '01', 'Februari': '02', 'Maret': '03', 'April': '04', 'Mei': '05', 'Juni': '06',
        'Juli': '07', 'Agustus': '08', 'September': '09', 'Oktober': '10', 'November': '11', 'Desember': '12'
      };
      
      const parts = dateString.split(' ');
      if (parts.length === 3) {
        const day = parts[0].padStart(2, '0');
        const month = months[parts[1]];
        const year = parts[2];
        date = new Date(`${year}-${month}-${day}`);
      }
    }
    // Format: "18/09/2020"
    else if (dateString.includes('/')) {
      const parts = dateString.split('/');
      if (parts.length === 3) {
        date = new Date(`${parts[2]}-${parts[1]}-${parts[0]}`);
      }
    }
    // Format default
    else {
      date = new Date(dateString);
    }
    
    if (date && !isNaN(date.getTime())) {
      return date.toLocaleDateString('id-ID', {
        day: '2-digit',
        month: 'long',
        year: 'numeric'
      });
    }
  } catch (e) {
    console.log('Date parsing error:', e);
  }
  
  // Jika tidak bisa di-parse, return as-is
  return dateString;
}

function getParameterByName(name) {
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}

// =================== LOAD DATA (MULTIPLE METHODS) ===================
async function loadMemberData() {
  try {
    // 1. Ambil ID dari URL
    currentMemberId = getParameterByName('id') || CONFIG.DEFAULT_ID;
    
    // 2. Tampilkan loading ID
    document.getElementById('loadingId').textContent = `ID: ${currentMemberId}`;
    
    // 3. Tampilkan INSTANT DATA langsung
    showInstantData();
    
    // 4. Coba load dari berbagai sumber (Opensheet, Google Sheets API, dll)
    setTimeout(() => tryAllDataSources(), 100);
    
  } catch (error) {
    console.error('Error in loadMemberData:', error);
  }
}

function showInstantData() {
  // Tampilkan data instan dari CONFIG
  const instantData = CONFIG.INSTANT_DATA[currentMemberId];
  
  if (instantData) {
    updateUI(instantData);
  } else {
    // Data fallback jika ID tidak dikenal
    updateUI({
      ID: currentMemberId,
      Nama: `Anggota ${currentMemberId}`,
      Status: 'AKTIF',
      Posisi: 'Anggota',
      Simpanan_Pokok: '0',
      SHU_Estimasi: '0'
    });
  }
  
  // Langsung tampilkan content, hide loading
  document.getElementById('loading').style.display = 'none';
  document.getElementById('content').style.display = 'block';
}

async function tryAllDataSources() {
  console.log('Trying all data sources...');
  
  // Coba Opensheet dulu
  if (await tryOpensheet()) {
    console.log('‚úÖ Success from Opensheet');
    showToast('‚úÖ Data diperbarui dari Google Sheets', 'success');
    return;
  }
  
  // Jika Opensheet gagal, coba Google Sheets API langsung
  if (await tryGoogleSheetsDirect()) {
    console.log('‚úÖ Success from Google Sheets API');
    showToast('‚úÖ Data dari Google Sheets', 'success');
    return;
  }
  
  console.log('‚ö†Ô∏è All data sources failed, using instant data');
  showToast('‚ö†Ô∏è Menggunakan data cache', 'info');
}

async function tryOpensheet() {
  try {
    console.log('Trying Opensheet...');
    
    const response = await fetch(CONFIG.OPENSHEET_URL + '?t=' + Date.now(), {
      headers: {
        'Cache-Control': 'no-cache',
        'Pragma': 'no-cache'
      }
    });
    
    if (!response.ok) {
      console.log(`Opensheet HTTP error: ${response.status}`);
      return false;
    }
    
    const data = await response.json();
    console.log('Opensheet data received:', data);
    
    // Convert array to object dengan ID sebagai key
    const membersMap = {};
    data.forEach(row => {
      if (row.ID && row.ID.trim() !== '') {
        // Bersihkan spasi di key names
        const cleanRow = {};
        Object.keys(row).forEach(key => {
          const cleanKey = key.trim();
          cleanRow[cleanKey] = row[key];
        });
        membersMap[row.ID] = cleanRow;
      }
    });
    
    allMembersData = membersMap;
    
    // Update UI dengan data real
    if (allMembersData[currentMemberId]) {
      updateUI(allMembersData[currentMemberId]);
      return true;
    }
    
  } catch (error) {
    console.error('Opensheet error:', error.message);
  }
  
  return false;
}

async function tryGoogleSheetsDirect() {
  try {
    console.log('Trying Google Sheets direct API...');
    
    const response = await fetch(CONFIG.GOOGLE_SHEETS_API + '&t=' + Date.now());
    
    if (!response.ok) {
      console.log(`Google Sheets API error: ${response.status}`);
      return false;
    }
    
    const text = await response.text();
    const json = JSON.parse(text.substring(47).slice(0, -2));
    
    const rows = json.table.rows;
    const headers = rows[0].c.map(cell => cell ? cell.v.toString().trim() : '');
    
    const membersMap = {};
    
    for (let i = 1; i < rows.length; i++) {
      const row = rows[i].c;
      if (!row[0] || !row[0].v) continue;
      
      const id = row[0].v.toString().trim();
      if (!id) continue;
      
      const member = {};
      
      for (let j = 0; j < headers.length; j++) {
        const key = headers[j];
        const value = row[j] ? (row[j].v !== null ? row[j].v.toString() : '') : '';
        member[key] = value;
      }
      
      membersMap[id] = member;
    }
    
    allMembersData = membersMap;
    
    if (allMembersData[currentMemberId]) {
      updateUI(allMembersData[currentMemberId]);
      return true;
    }
    
  } catch (error) {
    console.error('Google Sheets API error:', error.message);
  }
  
  return false;
}

function updateUI(data) {
  if (!data) return;
  
  console.log('Updating UI with data:', data);
  
  // Clean data - handle WhatsApp dengan spasi
  const cleanData = {};
  Object.keys(data).forEach(key => {
    const cleanKey = key.trim();
    cleanData[cleanKey] = data[key];
  });
  
  // Hitung total simpanan
  const simpananPokok = parseFloat(cleanData.Simpanan_Pokok || cleanData.Simpanan_Pokok || 0);
  const simpananWajib = parseFloat(cleanData.Simpanan_Wajib || cleanData.Simpanan_Wajib || 0);
  const simpananSukarela = parseFloat(cleanData.Simpanan_Sukarela || cleanData.Simpanan_Sukarela || 0);
  const totalSimpanan = simpananPokok + simpananWajib + simpananSukarela;
  
  // Update basic info
  document.getElementById('nama').textContent = cleanData.Nama || '-';
  document.getElementById('nia').textContent = `NIA : ${cleanData.ID || currentMemberId}`;
  
  // Update status
  const statusElement = document.getElementById('statusText');
  const status = (cleanData.Status || 'AKTIF').toUpperCase();
  statusElement.textContent = status;
  
  if (status === 'TIDAK AKTIF' || status === 'NON AKTIF') {
    statusElement.className = 'status-inactive';
  } else {
    statusElement.className = '';
  }
  
  // Update simpanan
  document.getElementById('pokok').textContent = formatRupiah(simpananPokok);
  document.getElementById('wajib').textContent = formatRupiah(simpananWajib);
  document.getElementById('sukarela').textContent = formatRupiah(simpananSukarela);
  
  // Update data pribadi
  document.getElementById('alamat').textContent = cleanData.Alamat || '-';
  document.getElementById('jk').textContent = cleanData.Jenis_Kelamin || cleanData.Jenis_Kelamin || '-';
  document.getElementById('agama').textContent = cleanData.Agama || '-';
  document.getElementById('nik').textContent = cleanData.NIK || '-';
  document.getElementById('email').textContent = cleanData.Email || '-';
  
  // Handle WhatsApp (dengan atau tanpa spasi)
  const whatsappValue = cleanData.WhatsApp || cleanData['WhatsApp '] || '-';
  document.getElementById('telepon').textContent = whatsappValue;
  
  document.getElementById('tglDaftar').textContent = formatDate(cleanData.Tanggal_Bergabung || cleanData.Tanggal_Bergabung || '-');
  
  // Update keuangan
  document.getElementById('totalSimpanan').textContent = formatRupiah(totalSimpanan);
  document.getElementById('totalPinjaman').textContent = formatRupiah(parseFloat(cleanData.Total_Pinjaman || 0));
  document.getElementById('shu').textContent = formatRupiah(parseFloat(cleanData.SHU_Estimasi || cleanData.SHU_Estimasi || 0));
  
  // Update foto
  const fotoElement = document.getElementById('fotoProfil');
  const fotoUrl = cleanData.Foto || CONFIG.DEFAULT_PHOTO;
  fotoElement.src = fotoUrl;
  fotoElement.alt = cleanData.Nama || 'Foto Profil';
  
  // Handle foto error
  fotoElement.onerror = function() {
    console.warn('Foto gagal dimuat:', fotoUrl);
    fotoElement.src = CONFIG.DEFAULT_PHOTO;
  };
  
  // Update timestamp
  const now = new Date();
  document.getElementById('lastUpdate').textContent = 
    `Terakhir update: ${now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}`;
  
  // Update tahun di footer
  document.getElementById('currentYear').textContent = now.getFullYear();
  
  // Update judul halaman
  if (cleanData.Nama) {
    document.title = `Kartu Anggota - ${cleanData.Nama}`;
  }
}

// =================== ACTION FUNCTIONS ===================
function refreshData() {
  // Clear cache dan reload
  allMembersData = {};
  loadMemberData();
  showToast('Memperbarui data dari Google Sheets...', 'info');
}

function exportPDF() {
  // [Sama seperti sebelumnya]
  const memberId = currentMemberId;
  const nama = document.getElementById('nama').textContent;
  
  const printContent = `
    <!DOCTYPE html>
    <html>
    <head>
      <title>Kartu Anggota - ${nama}</title>
      <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        h2 { color: #0f3d28; border-bottom: 2px solid #0f3d28; padding-bottom: 10px; }
        .info-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 10px; margin: 15px 0; }
        .info-item { padding: 8px 0; border-bottom: 1px solid #eee; }
        .label { font-weight: bold; color: #333; }
        .value { color: #555; }
        .footer { margin-top: 30px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 12px; color: #666; text-align: center; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: #0f3d28; margin: 5px 0; }
        .financial { background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .financial-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center; }
      </style>
    </head>
    <body>
      <div class="header">
        <h1>KOPERASI ASMARA TANI</h1>
        <p>Kartu Anggota Digital</p>
      </div>
      
      <h2>üìã Informasi Anggota</h2>
      <div class="info-grid">
        <div class="info-item"><span class="label">Nama:</span></div>
        <div class="info-item"><span class="value">${nama}</span></div>
        
        <div class="info-item"><span class="label">ID Anggota:</span></div>
        <div class="info-item"><span class="value">${memberId}</span></div>
        
        <div class="info-item"><span class="label">Status:</span></div>
        <div class="info-item"><span class="value">${document.getElementById('statusText').textContent}</span></div>
        
        <div class="info-item"><span class="label">Alamat:</span></div>
        <div class="info-item"><span class="value">${document.getElementById('alamat').textContent}</span></div>
        
        <div class="info-item"><span class="label">Telepon:</span></div>
        <div class="info-item"><span class="value">${document.getElementById('telepon').textContent}</span></div>
      </div>
      
      <div class="financial">
        <h3>üí∞ Informasi Keuangan</h3>
        <div class="financial-grid">
          <div>
            <div class="label">Simpanan Pokok</div>
            <div class="value">${document.getElementById('pokok').textContent}</div>
          </div>
          <div>
            <div class="label">Simpanan Wajib</div>
            <div class="value">${document.getElementById('wajib').textContent}</div>
          </div>
          <div>
            <div class="label">Simpanan Sukarela</div>
            <div class="value">${document.getElementById('sukarela').textContent}</div>
          </div>
        </div>
        <div style="text-align: center; margin-top: 15px;">
          <div class="label">Total Simpanan</div>
          <div class="value" style="font-size: 18px; font-weight: bold;">${document.getElementById('totalSimpanan').textContent}</div>
        </div>
      </div>
      
      <div class="footer">
        <p>¬© Koperasi Asmara Tani ${new Date().getFullYear()}</p>
        <p>Dicetak pada: ${new Date().toLocaleDateString('id-ID')} ${new Date().toLocaleTimeString('id-ID')}</p>
        <p>Data dari Google Sheets - Sistem Koperasi Digital</p>
      </div>
    </body>
    </html>
  `;
  
  const printWindow = window.open('', '_blank');
  printWindow.document.write(printContent);
  printWindow.document.close();
  
  setTimeout(() => printWindow.print(), 500);
}

function showToast(message, type = 'info') {
  const colors = {
    info: { bg: 'rgba(0, 255, 160, 0.9)', text: '#003a24' },
    success: { bg: 'rgba(76, 175, 80, 0.9)', text: '#fff' },
    error: { bg: 'rgba(244, 67, 54, 0.9)', text: '#fff' }
  };
  
  const toast = document.createElement('div');
  toast.textContent = message;
  toast.style.cssText = `
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: ${colors[type].bg};
    color: ${colors[type].text};
    padding: 12px 24px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    max-width: 80%;
    text-align: center;
  `;
  
  document.body.appendChild(toast);
  
  setTimeout(() => {
    document.body.removeChild(toast);
  }, 3000);
}

// =================== INITIALIZATION ===================
function initializeApp() {
  // 1. Load data pertama kali
  loadMemberData();
  
  // 2. Setup auto-refresh
  if (CONFIG.REFRESH_INTERVAL > 0) {
    setInterval(refreshData, CONFIG.REFRESH_INTERVAL * 1000);
  }
  
  // 3. Setup tahun di footer
  document.getElementById('currentYear').textContent = new Date().getFullYear();
}

// =================== EVENT LISTENERS ===================
document.addEventListener('DOMContentLoaded', initializeApp);

// =================== DEBUG FUNCTIONS ===================
window.debugData = function() {
  console.log('=== DEBUG INFO ===');
  console.log('Current ID:', currentMemberId);
  console.log('All Data:', allMembersData);
  console.log('Current Member Data:', allMembersData[currentMemberId]);
  console.log('Opensheet URL:', CONFIG.OPENSHEET_URL);
  console.log('Google Sheets:', 'https://docs.google.com/spreadsheets/d/1lWx-Utyl91udeO00NRfED3DydP39z1NXsX7grnzKEgU/edit');
  
  // Test Opensheet langsung
  fetch(CONFIG.OPENSHEET_URL)
    .then(r => r.json())
    .then(data => console.log('Opensheet Test Result:', data))
    .catch(err => console.error('Opensheet Test Error:', err));
};
</script>
</body>
</html>
